{% extends "base.html" %}

{% block title %}{{ post.title }} - Research Explorer{% endblock %}

{% block content %}
<p><a href="/posts">&larr; Back to posts</a></p>

<div class="card">
    <h1>{{ post.title }}</h1>

    <p>
        <span class="badge badge-{{ post.poster_gender }}">{{ post.poster_gender }}</span>
        {% if post.gender_confidence %}
        <span class="confidence">({{ "%.0f"|format(post.gender_confidence * 100) }}%)</span>
        {% endif %}
        &nbsp;
        <span class="badge badge-{{ post.relationship_type }}">{{ post.relationship_type }}</span>
        {% if post.situation_severity %}
        &nbsp;
        <span class="badge badge-{{ post.situation_severity }}">{{ post.situation_severity }} severity</span>
        {% endif %}
        {% if post.op_fault %}
        &nbsp;
        <span class="badge badge-{{ post.op_fault }}">{{ post.op_fault }} fault</span>
        {% endif %}
        {% if post.problem_category %}
        &nbsp;
        <span class="badge badge-category">{{ post.problem_category }}</span>
        {% endif %}
    </p>
    <p style="color: #666; font-size: 0.9em;">by {{ post.author }} &middot; {{ post.timestamp }}</p>

    {% if post.brief_situation_summary %}
    <p><strong>Summary:</strong> {{ post.brief_situation_summary }}</p>
    {% endif %}

    <h3>Original Post</h3>
    <div class="post-body">{{ post.body }}</div>
</div>

<div class="card">
    <h2>Comments ({{ comments|length }})</h2>

    {% for comment in comments %}
    <div class="comment">
        <div class="comment-meta">
            <strong>{{ comment.author }}</strong>
            &middot; {{ comment.timestamp }}
            {% if comment.score %}
            &middot; <span title="score">{{ comment.score }} â˜…</span>
            {% endif %}
            {% if comment.advice_direction %}
            &middot; <span class="badge badge-direction-{{ comment.advice_direction }}">{{ comment.advice_direction | replace('_', ' ') }}</span>
            {% endif %}
        </div>
        {% if comment.tone_labels %}
        <div class="tone-labels">
            {% for tone in comment.tone_labels %}
            <span class="tone-tag tone-{{ tone }}">{{ tone }}</span>
            {% endfor %}
        </div>
        {% endif %}
        <div style="white-space: pre-wrap;">{{ comment.body }}</div>
    </div>
    {% else %}
    <p>No comments yet.</p>
    {% endfor %}
</div>
{% endblock %}
